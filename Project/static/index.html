<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống quản lý hộ khẩu</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-home"></i> Hệ thống quản lý hộ khẩu và nhân khẩu</h1>
            <nav>
                <ul>
                    <li><a href="#" onclick="showSection('households')" class="active">Quản lý hộ khẩu</a></li>
                    <li><a href="#" onclick="showSection('persons')">Quản lý nhân khẩu</a></li>
                    <li><a href="#" onclick="showSection('temporary')">Tạm vắng/Tạm trú</a></li>
                    <li><a href="#" onclick="showSection('feedback')">Phản ánh/Kiến nghị</a></li>
                    <li><a href="#" onclick="showSection('statistics')">Thống kê</a></li>
                </ul>
            </nav>
            <div class="auth-bar">
                <div id="authUserInfo" class="auth-user-info" style="display:none">
                    <i class="fas fa-user-circle"></i>
                    <span id="authUsername">User</span>
                    <span class="role-badge" id="authRole">user</span>
                    <button class="btn btn-secondary" onclick="logout()">Đăng xuất</button>
                </div>
                <div id="authActions" class="auth-actions">
                    <button class="btn" onclick="openModal('loginModal')"><i class="fas fa-sign-in-alt"></i> Đăng nhập</button>
                    <button class="btn btn-outline" onclick="openModal('registerModal')"><i class="fas fa-user-plus"></i> Đăng ký</button>
                </div>
            </div>
        </header>

        <main>
            <!-- Quản lý hộ khẩu -->
            <section id="households" class="section active">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> Quản lý hộ khẩu</h2>
                    <button class="btn btn-primary" onclick="openModal('householdModal')">
                        <i class="fas fa-plus"></i> Thêm hộ khẩu mới
                    </button>
                </div>
                
                <div class="search-bar">
                    <input type="text" id="householdSearch" placeholder="Tìm kiếm theo số hộ khẩu hoặc địa chỉ...">
                    <button onclick="searchHouseholds()"><i class="fas fa-search"></i></button>
                </div>

                <div class="table-container">
                    <table id="householdsTable">
                        <thead>
                            <tr>
                                <th>Số hộ khẩu</th>
                                <th>Địa chỉ</th>
                                <th>Số thành viên</th>
                                <th>Ngày tạo</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="householdsTableBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Quản lý nhân khẩu -->
            <section id="persons" class="section">
                <div class="section-header">
                    <h2><i class="fas fa-user"></i> Quản lý nhân khẩu</h2>
                    <button class="btn btn-primary" onclick="openModal('personModal')">
                        <i class="fas fa-plus"></i> Thêm nhân khẩu mới
                    </button>
                </div>
                
                <div class="search-bar">
                    <input type="text" id="personSearch" placeholder="Tìm kiếm theo tên hoặc CCCD...">
                    <button onclick="searchPersons()"><i class="fas fa-search"></i></button>
                </div>

                <div class="table-container">
                    <table id="personsTable">
                        <thead>
                            <tr>
                                <th>Họ tên</th>
                                <th>Ngày sinh</th>
                                <th>Giới tính</th>
                                <th>CCCD</th>
                                <th>Quan hệ</th>
                                <th>Nghề nghiệp</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="personsTableBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Tạm vắng/Tạm trú -->
            <section id="temporary" class="section">
                <div class="section-header">
                    <h2><i class="fas fa-calendar-alt"></i> Quản lý tạm vắng/Tạm trú</h2>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="openModal('absenceModal')">
                            <i class="fas fa-user-minus"></i> Thêm tạm vắng
                        </button>
                        <button class="btn btn-success" onclick="openModal('residenceModal')">
                            <i class="fas fa-user-plus"></i> Thêm tạm trú
                        </button>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('absenceTab')">Tạm vắng</button>
                    <button class="tab-btn" onclick="showTab('residenceTab')">Tạm trú</button>
                </div>

                <div id="absenceTab" class="tab-content active">
                    <div class="table-container">
                        <table id="absencesTable">
                            <thead>
                                <tr>
                                    <th>Họ tên</th>
                                    <th>Số hộ khẩu</th>
                                    <th>Từ ngày</th>
                                    <th>Đến ngày</th>
                                    <th>Lý do</th>
                                    <th>Trạng thái</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="absencesTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="residenceTab" class="tab-content">
                    <div class="table-container">
                        <table id="residencesTable">
                            <thead>
                                <tr>
                                    <th>Họ tên</th>
                                    <th>Số hộ khẩu</th>
                                    <th>Từ ngày</th>
                                    <th>Đến ngày</th>
                                    <th>Lý do</th>
                                    <th>Trạng thái</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="residencesTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Phản ánh/Kiến nghị -->
            <section id="feedback" class="section">
                <div class="section-header">
                    <h2><i class="fas fa-comments"></i> Quản lý phản ánh/Kiến nghị</h2>
                    <button class="btn btn-primary" onclick="openModal('feedbackModal')">
                        <i class="fas fa-plus"></i> Thêm phản ánh/Kiến nghị
                    </button>
                </div>

                <div class="table-container">
                    <table id="feedbacksTable">
                        <thead>
                            <tr>
                                <th>Người phản ánh</th>
                                <th>Nội dung</th>
                                <th>Ngày phản ánh</th>
                                <th>Phân loại</th>
                                <th>Trạng thái</th>
                                <th>Phản hồi</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="feedbacksTableBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Thống kê -->
            <section id="statistics" class="section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> Thống kê</h2>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Thống kê theo giới tính</h3>
                        <div id="genderStats" class="stat-content"></div>
                    </div>
                    <div class="stat-card">
                        <h3>Thống kê theo độ tuổi</h3>
                        <div id="ageStats" class="stat-content"></div>
                    </div>
                    <div class="stat-card">
                        <h3>Thống kê phản ánh/Kiến nghị</h3>
                        <div id="feedbackStats" class="stat-content"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Đăng nhập</h3>
                <span class="close" onclick="closeModal('loginModal')">&times;</span>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">Tên đăng nhập</label>
                    <input type="text" id="loginUsername" name="username" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mật khẩu</label>
                    <input type="password" id="loginPassword" name="password" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('loginModal')">Hủy</button>
                    <button type="submit" class="btn btn-primary">Đăng nhập</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Đăng ký</h3>
                <span class="close" onclick="closeModal('registerModal')">&times;</span>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerUsername">Tên đăng nhập</label>
                    <input type="text" id="registerUsername" name="username" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Mật khẩu</label>
                    <input type="password" id="registerPassword" name="password" required>
                </div>
                <div class="form-group">
                    <label for="registerFullName">Họ và tên (tuỳ chọn)</label>
                    <input type="text" id="registerFullName" name="full_name">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('registerModal')">Hủy</button>
                    <button type="submit" class="btn btn-primary">Đăng ký</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Household Modal -->
    <div id="householdModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Thêm/Sửa hộ khẩu</h3>
                <span class="close" onclick="closeModal('householdModal')">&times;</span>
            </div>
            <form id="householdForm">
                <div class="form-group">
                    <label for="householdNumber">Số hộ khẩu:</label>
                    <input type="text" id="householdNumber" name="household_number" required>
                </div>
                <div class="form-group">
                    <label for="householdAddress">Địa chỉ:</label>
                    <textarea id="householdAddress" name="address" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('householdModal')">Hủy</button>
                    <button type="submit" class="btn btn-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Person Modal -->
    <div id="personModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Thêm/Sửa nhân khẩu</h3>
                <span class="close" onclick="closeModal('personModal')">&times;</span>
            </div>
            <form id="personForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="personName">Họ tên:</label>
                        <input type="text" id="personName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="personBirthDate">Ngày sinh:</label>
                        <input type="date" id="personBirthDate" name="birth_date" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="personGender">Giới tính:</label>
                        <select id="personGender" name="gender" required>
                            <option value="">Chọn giới tính</option>
                            <option value="nam">Nam</option>
                            <option value="nu">Nữ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="personIdNumber">CCCD:</label>
                        <input type="text" id="personIdNumber" name="id_number" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="personRelationship">Quan hệ:</label>
                        <select id="personRelationship" name="relationship" required>
                            <option value="">Chọn quan hệ</option>
                            <option value="chu_ho">Chủ hộ</option>
                            <option value="vo">Vợ</option>
                            <option value="chong">Chồng</option>
                            <option value="con">Con</option>
                            <option value="cha">Cha</option>
                            <option value="me">Mẹ</option>
                            <option value="anh_em">Anh/Em</option>
                            <option value="khac">Khác</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="personOccupation">Nghề nghiệp:</label>
                        <input type="text" id="personOccupation" name="occupation" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="personAddress">Địa chỉ:</label>
                    <textarea id="personAddress" name="address" required></textarea>
                </div>
                <div class="form-group">
                    <label for="personPhone">Số điện thoại:</label>
                    <input type="tel" id="personPhone" name="phone">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('personModal')">Hủy</button>
                    <button type="submit" class="btn btn-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Temporary Absence Modal -->
    <div id="absenceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Thêm tạm vắng</h3>
                <span class="close" onclick="closeModal('absenceModal')">&times;</span>
            </div>
            <form id="absenceForm">
                <div class="form-group">
                    <label for="absencePerson">Chọn nhân khẩu:</label>
                    <select id="absencePerson" name="person_id" required>
                        <option value="">Chọn nhân khẩu</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="absenceStartDate">Từ ngày:</label>
                        <input type="date" id="absenceStartDate" name="start_date" required>
                    </div>
                    <div class="form-group">
                        <label for="absenceEndDate">Đến ngày:</label>
                        <input type="date" id="absenceEndDate" name="end_date" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="absenceReason">Lý do:</label>
                    <textarea id="absenceReason" name="reason" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('absenceModal')">Hủy</button>
                    <button type="submit" class="btn btn-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Temporary Residence Modal -->
    <div id="residenceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Thêm tạm trú</h3>
                <span class="close" onclick="closeModal('residenceModal')">&times;</span>
            </div>
            <form id="residenceForm">
                <div class="form-group">
                    <label for="residencePerson">Chọn nhân khẩu:</label>
                    <select id="residencePerson" name="person_id" required>
                        <option value="">Chọn nhân khẩu</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="residenceStartDate">Từ ngày:</label>
                        <input type="date" id="residenceStartDate" name="start_date" required>
                    </div>
                    <div class="form-group">
                        <label for="residenceEndDate">Đến ngày:</label>
                        <input type="date" id="residenceEndDate" name="end_date" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="residenceReason">Lý do:</label>
                    <textarea id="residenceReason" name="reason" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('residenceModal')">Hủy</button>
                    <button type="submit" class="btn btn-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Thêm phản ánh/Kiến nghị</h3>
                <span class="close" onclick="closeModal('feedbackModal')">&times;</span>
            </div>
            <form id="feedbackForm">
                <div class="form-group">
                    <label for="feedbackPerson">Người phản ánh:</label>
                    <input type="text" id="feedbackPerson" name="person_name" required>
                </div>
                <div class="form-group">
                    <label for="feedbackContent">Nội dung:</label>
                    <textarea id="feedbackContent" name="content" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="feedbackDate">Ngày phản ánh:</label>
                        <input type="date" id="feedbackDate" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="feedbackCategory">Phân loại:</label>
                        <select id="feedbackCategory" name="category" required>
                            <option value="">Chọn phân loại</option>
                            <option value="phan_anh">Phản ánh</option>
                            <option value="kien_nghi">Kiến nghị</option>
                            <option value="khac">Khác</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="feedbackResponse">Phản hồi:</label>
                    <textarea id="feedbackResponse" name="response"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('feedbackModal')">Hủy</button>
                    <button type="submit" class="btn btn-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>
